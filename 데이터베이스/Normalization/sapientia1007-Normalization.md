# 🚩 정규화 (Normalization)
- 이상 현상이 발생하는 릴레이션을 분해하여 **이상 현상을 없애는 과정**
    - **이상현상** : 정규화를 거치지 않은 데이터에서 발생할 수 있는 현상
      - `삽입 이상 (Insertion Anamaly)` : 데이터 삽입 시, 의도와 다른 값들도 삽입 ➡️ 특정 속성에 해당하는 값이 없어 NULL값을 입력해야 하는 NULL값 문제 발생
       
        | 학번 (PK)   | 수강과목 번호 (PK) | 성적 | 이름   | 나이 | 주소   |
        |-------------|--------------------|------|--------|------|--------|
        | 20101111    | 0002              | A    | 유재석 | 21   | 서울시 |
        | 20091514    | 0001              | B+   | 지석진 | 25   | 대전시 |
        | 20181966    | 0003              | C    | 김종국 | 23   | 부산시 |
        | 20101254    | 0004              | B+   | 송지효 | 27   | 광주시 |

      ☑️ 새로운 학생 데이터 삽입 ➡️ 이때 수강 과목과 성적에 대한 데이터가 없어 NULL이 아래처럼 발생하는게 **삽입 이상**

      | 학번 (PK)   | 수강과목 번호 (PK) | 성적 | 이름   | 나이 | 주소   |
        |-------------|--------------------|------|--------|------|--------|
        | 20101111    | 0002              | A    | 유재석 | 21   | 서울시 |
        | 20091514    | 0001              | B+   | 지석진 | 25   | 대전시 |
        | 20181966    | 0003              | C    | 김종국 | 23   | 부산시 |
        | 20101254    | 0004              | B+   | 송지효 | 27   | 광주시 |
        | 20190001    | null              | null | 양세찬 | 27   | 성남시 |        

      - `삭제 이상 (Delete Anomaly)` : 데이터 삭제 시, 의도와 다른 정보들까지도 연쇄 삭제
       | 학번 (PK)   | 수강과목 번호 (PK) | 성적 | 이름   | 나이 | 주소   |
        |-------------|--------------------|------|--------|------|--------|
        | 20101111    | 0002              | A    | 유재석 | 21   | 서울시 |
        | 20091514    | 0001              | B+   | 지석진 | 25   | 대전시 |
        | 20181966    | 0003              | C    | 김종국 | 23   | 부산시 |
        | 20101254    | 0004              | B+   | 송지효 | 27   | 광주시 |

       ☑️ 0002 과목의 수강 취소 시, 해당 관련 데이터인 '유재석'도 삭제되는게 **삭제 이상**    

      - `갱신 이상 (Update Anomaly)` : 속성값 갱신 시, 일부 튜플만 갱신되어 모순 발생 ➡️ 불일치(Inconsistency) 문제 발생  
    
        | 학번 (PK)   | 수강과목 번호 (PK) | 성적 | 이름   | 나이 | 주소   |
        |-------------|--------------------|------|--------|------|--------|
        | 20101111    | 0002              | A    | 유재석 | 21   | 서울시 |
        | 20091514    | 0001              | B+   | 지석진 | 25   | 대전시 |
        | 20181966    | 0003              | C    | 김종국 | 23   | 부산시 |
        | 20101254    | 0004              | B+   | 송지효 | 27   | 광주시 |
        | 20101111    | 0004              | B    | 유재석 | 21   | 서울시 |
        
        ☑️ 이때 유재석의 주소 데이터를 갱신하려 한다면, 아래처럼 하나만 갱신되고 다른 하나는 갱신 안된게 **갱신 이상**
        
        | 학번 (PK)   | 수강과목 번호 (PK) | 성적 | 이름   | 나이 | 주소   |
        |-------------|--------------------|------|--------|------|--------|
        | 20101111    | 0002              | A    | 유재석 | 21   | **서울시** |
        | 20091514    | 0001              | B+   | 지석진 | 25   | 대전시 |
        | 20181966    | 0003              | C    | 김종국 | 23   | 부산시 |
        | 20101254    | 0004              | B+   | 송지효 | 27   | 광주시 |
        | 20101111    | 0004              | B    | 유재석 | 21   | **안양시** |

  - 이상 현상이 있는 릴레이션은 *이상 현상을 일으키는 함수 종속성의 유형에 따라 등급을 구분 가능*  
    👉🏻 릴레이션은 정규형 개념으로 구분  
    👉🏻 정규형이 높을수록 이상현상은 줄어듦   
    &nbsp; &nbsp; &nbsp; (🟰 안전성이 높아짐)  
- 데이터베이스의 릴레이션이나 튜플을 **불필요한 중복을 제거**
- 수정할 때 의도하지 않았던 불필요한 자료가 추가, 삭제, 갱신되는 일이 없도록 **DB를 재구성**하는 과정

👉🏻 테이블간에 중복된 데이터를 허용 ❌ ➡️ 무결성 유지 + DB 저장 용량 역시 감소 

**정규화의 목적**
- 데이터 구조의 안정성 최대화
- 중복을 배제하여 삽입, 삭제, 갱신 이상의 발생 방지
- 어떠한 릴레이션이라도 데이터베이스 내에서 표현 가능하도록
- 데이터의 삽입 시 릴레이션을 재구성할 필요성을 감소
- 효과적인 검색 알고리즘 생성


## 📌 정규화 방법
1. 하나 이상의 릴레이션을 **두 개 이상의 릴레이션으로 분해** 🟰 Decomposition
2. 분해한 릴레이션을 다시 조인했을 때, 저장 정보의 손실 없이 원래의 릴레이션을 생성할 수 있는 것 🟰 무손실 분해 (Lossless Decomposition)
    - 릴레이션 R을 릴레이션 R1과 R2로 분해할 때, `R1 ⨝ R2 = R`이면 **무손실 분해** 
    - 무손실 분해를 위한 조건
       - 공통된 속성 (R1 ⋂ R2) = R1 이거나 공통된 속성 (R1 ⋂ R2) = R2 이어야 함
    - R1 ⨝ R2할때, 정보의 손실이 발생하거나 의미 없는 튜플이 생기면 무손실 분해 조건 만족 ❌ 
### 📌 릴레이션으로 분해
**정규화**

![정규화](https://velog.velcdn.com/images/sapientia/post/5af36274-af03-48b7-a8d8-7b4bb9ba053d/image.png)
### ✔️ 제 1정규형 (1NF)
- 릴레이션 R의 모든 속성값이 **원자값을 가지면** `제 1정규형`이라고 함  
(모든 열과 행에는 '열과 행의 해당되는 분야에서 **한 개의 값을 가진다**')

2개 이상의 속성 값을 가지면, **제 1정규형 위반**으로, **제 1정규형으로 변환**하여 해결

|   이름 |    취미들    |
|--------|-------------|
| 유재석 |   인터넷     |
| 지석진 |   음악       |
| 김종국 |   음악, 운동 |
| 송지효 |   음악, 쇼핑 |

👉🏻 위 테이블에서는 몇몇 취미에는 `두 개의 속성 값`을 가지므로 **제 1 정규형 위반**    
☑️ 위반 해결 : 속성 값이 `원자값`을 갖도록 분해 
|   이름 |    취미들    |
|--------|-------------|
| 유재석 |     인터넷   |
| 송지효 |     쇼핑     |
| 지석진 |     음악     |
| 김종국 |     음악     |
| 김종국 |     운동     |
| 송지효 |     음악     |

### ✔️ 제 2정규형 (2NF)
- 릴레이션 R이 **제 1정규형**이고 기본키가 아닌 속성이 기본키에 **완전 함수 종속**일 때 `제 2정규형`이라고 함   
(🟰 부분 함수 종속이 발생하지 않게 만들기)
  -  완전 함수 종속 ( full functional dependency ) 
     - A와 B가 릴레이션 R의 속성이고 A ➡️ B 종속성이 성립
     - B가 A의 속성 전체에 함수 종속하고, 부분 집합 속성에 함수 종속하지 않을 경우
        > 함수 종속 : 릴레이션 R에서 속성 A가 속성 B를 결정할 때, B가 A에 **함수 종속**   
        > ex. 학번 20102001, 학생 유재석 / 학번 20102002, 학생 김종국 이면 학번 ➡️ 학생 이름 관계가 있으므로 이는 종속 관계 
      - ex. (학번, 과목번호)로 인해 학생의 (점수)를 결정지을 수 있지만, 각 (학번)과 (과목번호)로는 (점수)를 결정 지을 수 없음 
      - 기본키가 아닌 모든 속성들이 기본키에 완전 함수 종속 

      
|   학번  |    과목번호    |    과목이름    |   점수  |
|---------|---------------|---------------|---------|
| 2020001 |   A001051     | 데이터베이스   |   A     |
| 2020002 |   B002032     | 소프트웨어융합 |   B     |
| 2020003 |   A001051     | 알고리즘       |   A+    |
| 2020004 |   C005059     | 컴퓨터구조     |   B     |

👉🏻 위 테이블에서는 `(학번, 과목번호)➡️(점수)`, `(과목번호)➡️(과목이름)`의 종속성이 존재하므로 **제 2 정규형 위반**    
☑️ 위반 해결 : `(과목, 수강)`으로 릴레이션을 분해
|    과목번호    |    과목이름    |
|---------------|---------------|
|   A001051     | 데이터베이스   |
|   B002032     | 소프트웨어융합 | 
|   A001051     | 알고리즘       |
|   C005059     | 컴퓨터구조     |

|   학번  |    과목번호    |   점수  |
|---------|---------------|---------|
| 2020001 |   A001051     |   A     |
| 2020002 |   B002032     |   B     |
| 2020003 |   A001051     |   A+    |
| 2020004 |   C005059     |   B     |

### ✔️제 3정규형 (3NF)
- 릴레이션 R이 **제 2정규형**이고 기본키가 아닌 속성이 기본키에 **비 이행적(Non-Transitive; 직접 종속)으로 종속**할때 `제 3정규형`이라고 함   
   - 이행적 종속 
     - A➡️B, B➡️C가 성립할때, A➡️C가 성립되는 함수 종속성

| 대여번호 | 학생번호 | 도서번호 | 도서제목     |
|--------------|--------------|--------------|-----------------|
| 1            | 501          | B001         | 데이터베이스     |
| 2            | 502          | B002         | 자료구조         |
| 3            | 501          | B002         | 자료구조         | 

👉🏻 위 테이블에서는 `(대여번호)➡️(도서번호)➡️(도서제목)`의 이행적 종속이 존재하므로 **제 3 정규형 위반**    
☑️ 위반 해결 : `(대여, 도서)`으로 릴레이션을 분해
| 대여번호 |    학생번호    |   도서번호  |
|---------|---------------|-------------|
|   1     |    501        |    B001     |
|   2     |    502        |    B002     |
|   3     |    501        |    B002     |

|    도서번호    |      도서제목     |
|----------------|------------------|
|   B001         |   데이터베이스    |
|   B002         |   자료구조        |


### ✔️ BCNF (Boyce Codd Normal Form)
- 릴레이션의 **모든 결정자가 후보키**인 릴레이션이 `강한 제 3정규형(3.5NF)`라고 함
  - 릴레이션 R에서 함수 종속성 X ➡️ Y가 성립할 때, 모든 결정자 X가 후보키이면 BCNF
- 결정자이면서 후보키가 아닌 것 제거

|  학생번호  |    특강이름    |     교수     |
|-----------|----------------|--------------|
|   501     |  알고리즘       |    김교수    |
|   502     |  소프트웨어융합 |    이교수     |
|   403     |   컴퓨터구조    |    박교수     |
|   405     |  소프트웨어융합 |    이교수     |
|   505     |  소프트웨어융합 |    강교수     |

👉🏻 위 테이블에서는 `(학생번호, 특강이름)➡️(교수)`로  `(학생번호, 특강이름)`은 교수의 **결정자**이고, `(학생번호, 특강이름)`이 테이블을 고유하게 식별할 수 있는 **후보키**    
👉🏻 `(교수)➡️(특강이름)`으로, `교수`가 `특강이름`을 결정하는 **결정자**이지만,  `교수`가 테이블을 고유하게 식별할 수 있는 **후보키**가 아니기 때문에  **제 3 정규형 위반**    
☑️ 위반 해결 : `(특강수강, 특강교수)`로 분해

|  학생번호  |     교수     |
|-----------|--------------|
|   501     |    김교수     |
|   502     |    이교수     |
|   403     |    박교수     |
|   405     |    이교수     |
|   505     |    강교수     |

|    특강이름    |     교수     |
|----------------|--------------|
|  알고리즘       |    김교수    |
|  소프트웨어융합 |    이교수     |
|   컴퓨터구조    |    박교수     |
|  소프트웨어융합 |    이교수     |
|  소프트웨어융합 |    강교수     |

<u>**🔊 대부분의 릴레이션은 BCNF까지 정규화하면 실제적인 이상현상이 없어지기 때문에
보통 BCNF까지 정규화를 진행함 !!!!!**</u>

### ✔️ 제 4정규형 (4NF)
- 릴레이션 R에서 다치종속(Multi-Value Dependency) 발생

|      과목     |    교재           |     교수      |
|---------------|------------------|---------------|
|   알고리즘     |   알고리즘       |    김교수      |
|   데이터베이스  |   DB 이론       |    이교수      |
|   컴퓨터구조    |   컴퓨터구조론   |    박교수     |
|   컴퓨터구조    |   컴퓨터구조     |    이교수     |
|   데이터베이스  |   DB 이론        |    이교수     |

👉🏻 위 테이블에서는 `(과목)➡️(교재)`로 하나의 과목에 여러 교재가 있을 수 있고,  `(과목)➡️(교수)`로 하나의 과목에 여러 교수가 존재할 수 있기 때문에 `(과목)`은 `(교재)`와 `(교수)`를 *독립적으로 결정*하므로 다치 종속 발생으로 **제 4 정규형 위반**    
👉🏻 하나의 과목에 대해 여러 교재와 여러 교수가 존재
☑️ 위반 해결 : `(과목, 강의)`로 분해

| 과목       | 교재         |
|------------|--------------|
| 알고리즘   | 알고리즘     |
| 데이터베이스 | DB 이론     |
| 컴퓨터구조 | 컴퓨터구조론 |
| 컴퓨터구조 | 컴퓨터구조   |
| 데이터베이스 | DB 이론     |


| 과목       | 교수     |
|------------|----------|
| 알고리즘   | 김교수   |
| 데이터베이스 | 이교수   |
| 컴퓨터구조 | 박교수   |
| 컴퓨터구조 | 이교수   |
| 데이터베이스 | 이교수   |

### ✔️ 제 5정규형 (5NF)
- 더 이상 비손실 분해를 할 수 없어야 하는게 `제 5정규형`이라고 함 
- **조인 종속**을 제거 해야함
  - 조인 종속 (Joint Dependency)
    - 하나의 릴레이션을 여러개의 릴레이션으로 분해했다가, 다시 조인했을 때 데이터 손실이 없고 필요 없는 데이터가 생기는 것을 말함


    | 학생번호 | 과목       | 교수     |
    |----------|------------|----------|
    | 501      | 알고리즘   | 김교수   |
    | 501      | 데이터베이스 | 이교수   |
    | 502      | 컴퓨터구조 | 박교수   |
    | 502      | 알고리즘   | 김교수   |
    | 503      | 데이터베이스 | 이교수   |

👉🏻 위 테이블에서는 서로 독립적으로 결합할 수 있는 데이터로 `학생번호-과목`, `과목-교수`, `학생번호-교수`간의 조인 종속성이 발생하므로 **제 5정규형 위반**  
☑️ 위반 해결 : 불필요한 중복을 제거하고, 조인을 통해 릴레이션 분해

| 학생번호 | 과목       |
|----------|------------|
| 501      | 알고리즘   |
| 501      | 데이터베이스 |
| 502      | 컴퓨터구조 |
| 502      | 알고리즘   |
| 503      | 데이터베이스 |

| 과목       | 교수     |
|------------|----------|
| 알고리즘   | 김교수   |
| 데이터베이스 | 이교수   |
| 컴퓨터구조 | 박교수   |

| 학생번호 | 교수     |
|----------|----------|
| 501      | 김교수   |
| 501      | 이교수   |
| 502      | 박교수   |
| 502      | 김교수   |
| 503      | 이교수   |


---
> 출처
> - https://mangkyu.tistory.com/110
> - https://hstory0208.tistory.com/entry/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%EC%A0%95%EA%B7%9C%ED%99%94Normalization%EB%9E%80-%EC%98%88%EC%8B%9C%EB%A5%BC-%ED%86%B5%ED%95%B4-%EC%89%BD%EA%B2%8C-%EC%9D%B4%ED%95%B4%ED%95%B4%EB%B3%B4%EC%9E%90
> - https://superohinsung.tistory.com/111
> - https://velog.io/@wisdom-one/%EC%A0%95%EA%B7%9C%ED%99%94Normalization#6-%EC%A0%9C-5%EC%A0%95%EA%B7%9C%ED%99%94-5nf
> - MySQL로 배우는 데이터베이스 