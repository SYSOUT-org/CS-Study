# 정규화

## 정규화가 왜 필요할까?
여러분이 쇼핑몰을 운영하는 사장이라고 생각해볼게요.  
어느 날 쇼핑몰 운영 데이터를 확인했는데, 다음과 같이 데이터가 저장되어 있다면 어떤 문제가 생길까요?

| OrderID | CustomerId | CustomerName | CustomerAddress | ProductDetails         | Quantity | Discount |
|---------|------------|--------------|-----------------|------------------------|-----|----------|
| 101     | 1          |김철수         | 서울시 강남구       | 청바지:50,000; 티셔츠:30,000 | 2, 1 | 5%, 7%   |
| 102     | 2          |박영희         | 서울시 서초구       | 셔츠:40,000              | 1   | 10%      |
| 103     | 1          |김철수         | 서울시 강남구       | 청바지:50,000; 티셔츠:30,000 | 1, 2 | 5%, 7%   |
| 105     | 2          |박영희         | 서울시 서초구       | 티셔츠:30,000             | 2   | 7%       |

---
### 발생할 수 있는 문제점
> 1. 데이터베이스의 **이상현상(Anomaly)** 이 발생할 수 있어요.  
> 2. 검색 속도가 느려질 수 있어요.

### 이상현상이란? 
#### 삽입 이상 (Insertion Anomaly)  
- 새로운 상품 “운동화:60,000”을 추가하려고 하는데 아직 주문되지 않았다면 
OrderID, CustomerName, CustomerAddress와 같은 정보가 없어서 추가가 불가능합니다. 

#### 갱신 이상 (Update Anomaly)
- **김철수**의 주소가 변경되면 모든 레코드를 찾아 수정을 해야 합니다.
일부만 수정되면 데이터 불일치 발생합니다.

#### 삭제 이상 (Deletion Anomaly)
- 주문 OrderID 102를 삭제한다고 가정하면 “셔츠:40,000”이라는 상품 정보도 함께 손실됩니다.
---
### 이렇듯 다양한 문제가 발생하는데요.   
#### 이러한 문제 상황을 해결하기 위해서는 정규형으로 전환하는 과정이 필요하다고 합니다.

## 정규화란?
> 관계형 데이터베이스의 설계에서 데이터 중복을 줄이고 데이터 무결성을 개선하기 위해         
> 데이터를 정규형(normal form)에 맞도록 구조화하는 프로세스.  


## 정규화의 종류 및 예시
정규화 과정을 위에서 예시로 보여드렸던 쇼핑몰 데이터와 함께 설명해보도록 하겠습니다.

### 제1정규형 (1NF: First Normal Form)
> 각 열(컬럼)의 값이 **원자값(Atomic Value)** 을 가져야 합니다.

- 비원자값 제거:
  - `ProductDetails`, `Quantity`, `Discount`의 비원자값을 개별 행으로 분리.

| OrderID | CustomerId | CustomerName | CustomerAddress | ProductName | Price   | Quantity |
|---------|------------|--------------|-----------------|-------------|---------|----------|
| 101     | 1          | 김철수          | 서울시 강남구      | 청바지        | 50,000  | 2        |
| 101     | 1          | 김철수          | 서울시 강남구      | 티셔츠        | 30,000  | 1        |
| 102     | 2          | 박영희          | 서울시 서초구      | 셔츠         | 40,000  | 1        |
| 103     | 1          | 김철수          | 서울시 강남구      | 청바지        | 50,000  | 1        |
| 103     | 1          | 김철수          | 서울시 강남구      | 티셔츠        | 30,000  | 2        |
| 105     | 2          | 박영희          | 서울시 서초구      | 티셔츠        | 30,000  | 2        |

이렇게 각 컬럼의 값이 원자값으로 처리되면 비원자값으로 인해 발생하던 검색, 수정, 삽입의 어려움이 해소될 수 있습니다

---

### 제2정규형 (2NF: Second Normal Form)
> 1NF를 만족하며, 부분 함수 종속을 제거해야 합니다.  
> 즉 기본 키의 일부가 특정 속성을 결정하는 경우 이를 분리합니다.

- 부분 함수 종속 제거:
  - `CustomerName`과 `CustomerAddress`가 `CustomerID`에만 종속되므로 **Customer 테이블**로 분리.
  - 주문 정보(`OrderID`, `CustomerID`)와 상품 정보(`ProductName`, `Price`, `Quantity`, `Discount`)를 분리.

**Customer 테이블**:

| CustomerId | CustomerName | CustomerAddress |
|------------|--------------|-----------------|
| 1          | 김철수         | 서울시 강남구       |
| 2          | 박영희         | 서울시 서초구       |

**Order 테이블**

| OrderID | CustomerID |
|---------|------------|
| 101     | 1          |
| 102     | 2          |
| 103     | 1          |
| 105     | 2          |

**OrderDetails 테이블**:

| OrderID | ProductName | Price   | Quantity | Discount |
|---------|-------------|---------|----------|----------|
| 101     | 청바지        | 50,000  | 2        | 5%       |
| 101     | 티셔츠        | 30,000  | 1        | 7%       |
| 102     | 셔츠         | 40,000  | 1        | 10%      |
| 103     | 청바지        | 50,000  | 1        | 5%       |
| 103     | 티셔츠        | 30,000  | 2        | 7%       |
| 105     | 티셔츠        | 30,000  | 2        | 7%       |

이렇게 부분 함수 종속을 제거하면 중복 데이터로 인한 데이터 수정, 삽입, 삭제 시의 문제를 해결할 수 있습니다.

---

### 제3정규형 (3NF: Third Normal Form)
> 2NF를 만족하며, 이행적 함수 종속(Transitive Dependency)을 제거해야 합니다.  
> 즉, 기본 키가 아닌 속성이 다른 기본 키가 아닌 속성을 결정하지 않도록 설계.

- 이행 함수 종속 제거:
  - `Discount`, `Price`가 `ProductName`을 통해 결정되므로 **Product 테이블**로 분리.


**OrderDetails 테이블**

| OrderID | ProductName | Quantity |
|---------|-------------|----------|
| 101     | 청바지        | 2        |
| 101     | 티셔츠        | 1        |
| 102     | 셔츠         | 1        |
| 103     | 청바지        | 1        |
| 103     | 티셔츠        | 2        |
| 105     | 티셔츠        | 2        |

**Product 테이블**

| ProductName | Price   | Discount |
|-------------|---------|----------|
| 청바지        | 50,000  | 5%       |
| 티셔츠        | 30,000  | 7%       |
| 셔츠         | 40,000  | 10%      |

이렇게 이행 함수 종속을 제거하면 데이터 중복을 줄이고, 수정 시 데이터 불일치를 방지할 수 있습니다.

---

## 정규화로 인한 이점

정규화라는 과정은 위에서 예시로 들었던 초기 데이터에서는 기대할 수 없었던 다음 효과들을 얻게 됩니다!

1.	데이터 무결성 보장: 데이터 불일치 및 이상현상 방지.
2.	효율적인 데이터 관리: 중복 데이터 제거로 저장 공간 절약 및 관리 비용 감소.
3.	성능 향상: 쿼리 최적화로 인해 검색 및 수정 속도 개선.
4.	유지보수 용이성: 테이블 간 관계를 명확히 정의하여 확장성과 유지보수성 강화.
---

### 제3정규형 이후의 정규화 과정?
BCNF, 4NF, 5NF ... 과정이 있으나

제3정규형이 데이터 중복 제거와 무결성 확보를 위한 현실적이고 실질적인 기준점이기 때문에
제3정규형이 관계형 데이터베이스 설계에서 정규화된 상태를 의미하는 최소한의 기준으로 간주됩니다!   

따라서 이 이상의 정규화(BCNF, 4NF, 5NF)는 특정 상황에서 필요할 수 있지만, 
대부분의 경우 3NF로도 충분한 무결성과 성능을 보장할 수 있다고 합니다!
